<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tetris!</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas { display: block; margin: 0 auto; }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="750" height="750"></canvas>
    <script>

      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      var canvasWidth = 750;
      var canvasHeight = 750;

      var upPressed = false;
      var downPressed = false;
      var leftPressed = false;
      var rightPressed = false;

      var sqrsAcross = 16;
      var sqrsTall = 20;
      var cubeSide = 30;

      var pieceY = 1;
      var pieceX = 125;
      var pieceTimer = 0;
      var piecePos = 0;

      var long = {};
      long[0] = [[0,1],[1,1],[2,1],[3,1]];
      long[1] = [[2,0],[2,1],[2,2],[2,3]];
      long[2] = [[0,2],[1,2],[2,2],[3,2]];
      long[3] = [[1,0],[1,1],[1,2],[1,3]];
      long["color"] = "green";

      var ell1 = {};
      ell1[0] = [[1,0],[1,1],[1,2],[0,2]];
      ell1[1] = [[0,0],[0,1],[1,1],[2,1]];
      ell1[2] = [[1,0],[2,0],[1,1],[1,2]];
      ell1[3] = [[0,1],[1,1],[2,1],[2,2]];
      ell1["color"] = "orange";

      var ell2 = {};
      ell2[0] = [[1,0],[1,1],[1,2],[2,2]];
      ell2[1] = [[0,1],[1,1],[2,1],[0,2]];
      ell2[2] = [[0,0],[1,0],[1,1],[1,2]];
      ell2[3] = [[2,0],[0,1],[1,1],[2,1]];
      ell2["color"] = "yellow";

      var square = {};
      square[0] = [[0,0],[1,0],[0,1],[1,1]];
      square[1] = [[0,0],[1,0],[0,1],[1,1]];
      square[2] = [[0,0],[1,0],[0,1],[1,1]];
      square[3] = [[0,0],[1,0],[0,1],[1,1]];
      square["color"] = "pink";

      var zag1 = {};
      zag1[0] = [[1,1],[2,1],[0,2],[1,2]];
      zag1[1] = [[0,0],[0,1],[1,1],[1,2]];
      zag1[2] = [[1,0],[2,0],[0,1],[1,1]];
      zag1[3] = [[1,0],[1,1],[2,1],[2,2]];
      zag1["color"] = "purple";

      var tee = {};
      tee[0] = [[0,1],[1,1],[2,1],[1,2]];
      tee[1] = [[1,0],[0,1],[1,1],[1,2]];
      tee[2] = [[1,0],[0,1],[1,1],[2,1]];
      tee[3] = [[1,0],[1,1],[1,2],[2,1]];
      tee["color"] = "red";

      var zag2 = {};
      zag2[0] = [[0,1],[1,1],[1,2],[2,2]];
      zag2[1] = [[1,0],[0,1],[1,1],[0,2]];
      zag2[2] = [[0,0],[1,0],[1,1],[2,1]];
      zag2[3] = [[2,0],[1,1],[2,1],[1,2]];
      zag2["color"] = "blue";

      var pieces = [long, ell1, ell2, square, zag1, tee, zag2];
      var pieceQueue = [];

      var grid = [

        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],
        ["x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"],

      ];

      function draw() {

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        pieceTimer += 1;

        if (pieceTimer === 10) {
          // pieceY += 31;
          pieceTimer = 0;
        }

        var x = 1;
        var y = 1;

        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, (sqrsAcross*(cubeSide+1)+1), (sqrsTall*(cubeSide+1)+1));

        grid.forEach((row) => {

          row.forEach((square) => {

            if (square === "x") {
              ctx.fillStyle = "white";
              ctx.fillRect(x,y,cubeSide,cubeSide);
            } else {
              ctx.fillStyle = "orange";
              ctx.fillRect(x,y,cubeSide,cubeSide);
            }

            x += cubeSide + 1;

          });

          y += cubeSide + 1;
          x = 1;

        });

        if (leftPressed && pieceX > 0) {
          pieceX -= 1;
        };

        if (rightPressed && pieceX < sqrsAcross - 4) {
          pieceX += 1;
        };

        if (upPressed && piecePos < 3) {
          piecePos += 1;
        } else if (upPressed & piecePos >= 3) {
          piecePos = 0;
        }

        drawPiece(zag2);

      }

      function drawPiece(piece) {
        ctx.fillStyle = piece["color"];
        for (let idx = 0; idx < 4; idx++) {
          let x = piece[piecePos][idx][0];
          let y = piece[piecePos][idx][1];
          ctx.fillRect(pieceX+(x*31), pieceY+(y*31), cubeSide, cubeSide);
        }
      }

      function keyDownHandler(e) {
        if(e.keyCode == 39) {
          rightPressed = true;
        }
        else if(e.keyCode == 37) {
          leftPressed = true;
        }
        else if(e.keyCode == 38) {
          upPressed = true;
        }
        else if(e.keyCode == 40) {
          downPressed = true;
        }
      }

      function keyUpHandler(e) {
        if(e.keyCode == 39) {
          rightPressed = false;
        }
        else if(e.keyCode == 37) {
          leftPressed = false;
        }
        else if(e.keyCode == 38) {
          upPressed = false;
        }
        else if(e.keyCode == 40) {
          downPressed = false;
        }
      }

      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      setInterval(draw, 50);

    </script>
  </body>
</html>
